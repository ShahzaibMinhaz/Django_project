<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="" method="POST" id="post-form">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" name="submit" id="submit" value="submit">
    </form>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>
<script type="text/javascript">
   

    $('#post-form').on('submit', function(event){
        event.preventDefault();
        Name = document.getElementById('name').value
        Email = document.getElementById('email').value
        saveData()
    });
    function getCookie(c_name) {
      if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
          c_start = c_start + c_name.length + 1;
          c_end = document.cookie.indexOf(";", c_start);
          if (c_end == -1) c_end = document.cookie.length;
          return unescape(document.cookie.substring(c_start, c_end));
        }
      }}

    function saveData() {
        $.ajax({
            headers:{
                "X-CSRFToken": getCookie("csrftoken")
            },
            url : "getdata/", // the endpoint
            type : "POST", // http method
            data : { 'name' : Name,'email': Email }, // data sent with the post request

            // handle a successful response
            success : function(data) {
                // $('#post-text').val(''); // remove the value from the input
                // alert(json)
                
                console.log(data.email); // log the returned json to the console
                // console.log("success"); // another sanity check
            },

            // handle a non-successful response
            error : function(xhr,errmsg,err) {
                $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                    " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom    
               
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
        });
    };
</script>
  
</body>
</html>