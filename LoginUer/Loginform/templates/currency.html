<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
   <form method="POST" id="post-form" action="getcurrency/">
       {% csrf_token %}
       <h1>Select country of which you want usd eachange rate</h1>
       <select name="country" id="country">
        <option value="Select country code">Select country code</option>
        {% for country in countryname  %}
            <option value="{{ country }}">{{ country }}</option>
        {% endfor %}
        <!-- <input type="text" value="" name="value"> -->
      </select>
       <input type="submit" value="submit" id="submit">
   </form>
  
   <h1 id="result"> </h1>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>
<script type="text/javascript">
   
    var selectedCountry
    $("#country").change(function(){
        selectedCountry = $(this).children("option:selected").val();
    })

    $('#post-form').on('submit', function(event){
        event.preventDefault();
        if(selectedCountry == undefined){
            alert('Country is not Selected')
        }else{
            getcuurency()
            document.getElementById('result').innerHTML = 'waiting...'
        }
    });
    function getCookie(c_name) {
      if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
          c_start = c_start + c_name.length + 1;
          c_end = document.cookie.indexOf(";", c_start);
          if (c_end == -1) c_end = document.cookie.length;
          return unescape(document.cookie.substring(c_start, c_end));
        }
      }}

    function getcuurency() {
        console.log('selectedCountry = '+selectedCountry) // sanity check
        $.ajax({
            headers:{
                "X-CSRFToken": getCookie("csrftoken")
            },
            url : "getcurrency/", // the endpoint
            type : "POST", // http method
            data : { 'value' : selectedCountry }, // data sent with the post request

            // handle a successful response
            success : function(json) {
                // $('#post-text').val(''); // remove the value from the input
                // alert(json)
                document.getElementById('result').innerHTML = '1 USD to '+selectedCountry+' exchange rate = '+json
                console.log(); // log the returned json to the console
                console.log("success"); // another sanity check
            },

            // handle a non-successful response
            error : function(xhr,errmsg,err) {
                $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                    " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
               
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
        });
    };
</script>
</body>
</html>